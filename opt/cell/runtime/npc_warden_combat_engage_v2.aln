DEF npc.warden.combat_engage_cell {

  # --- 1. Player attribute snapshot (V.I.T.A.L.I.T.Y., secondary) ----------
  player_attributes: {
    vitality:   5.0,
    instinct:   4.0,
    tenacity:   3.0,
    agility:    3.0,
    logic:      4.0,
    influence:  2.0,
    temper:     5.0,
    yield:      4.0,

    constitution: 4.0,
    dexterity:    5.0,
    intelligence: 5.0,
    luck:         7.0,
    speed:        4.0,
    strength:     3.0
  },

  # Derived survival pools (after armor, traits, fractures) [PlayerVitalitySystem]
  player_pools_effective: {
    blood:          250.0,
    blood_max:      250.0,
    oxygen_max:     80.0,
    stamina_max:    100.0,
    wellness_max:   80.0,
    body_temp:      33.0,
    body_temp_min:  26.0,
    body_temp_max:  41.0
  },

  # --- 2. Equipment + status, converted to Cell assets/traits --------------
  equipment_slots: {
    torso_armor: "ARM_REACTIVE_PLATE_MK1",     # ArmorDefinition id
    head_gear:   "ARM_CRACKED_POLAR_VISOR",
    hands:       "ARM_JAMMED_EXO_GAUNTLET",
    feet:        "ARM_PERMAFROST_FEET"         # or suit boots
  },

  # Status effects as Cell traits/fractures (no SPECIAL wording)
  active_traits: [
    "COND_DEHYDRATED",
    "COND_HUNGRY",
    "COND_SLEEP_DEPRIVED",
    "COND_MILD_HYPOTHERMIA",
    "COLDVERGERUNNER",          # environment traversal trait
    "IRONLUNGS",                # oxygen efficiency
    "HARDENEDBLOOD"             # scarring fracture: less bleed, worse stamina
  ],

  # Environment profile: Cold Verge hull whiteout
  env_profile: {
    region_id:     "COLDVERGE_HIGHRIDGE",
    tags:          [ "COLDVERGE", "HULLEXTERIOR", "LOWVIS" ],
    visibility:    "low",
    hypothermia_risk: true,
    perception_penalty: -2.0
  },

  # --- 3. Player combat profile (Cell weapon schema) -----------------------
  player_combat_profile: {
    level: 16,
    attributes_ref: "player_attributes",
    vitality_ref:   "player_pools_effective",

    primary_weapon: "WPN_10MM_SCRAP_PISTOL",  # WeaponDefinition id
    ammo_id:        "AMMO_10MM_FMJ_STANDARD",

    # Local combat tuning derived from traits/fractures
    hit_model: {
      # Luck feeds into crit; Instinct + Dexterity into accuracy. [file:2][file:3]
      base_hit:          0.70,
      perception_weight: 0.10,       # mapped from Instinct/Logic
      dexterity_weight:  0.10,
      target_agility_weight: -0.10,
      stealth_penalty_if_invisible: -0.30
    },

    crit_model: {
      base_from_luck: 0.05,
      fracture_or_trait_bonus: 0.20,  # e.g. HULLLINEMARKSMAN / COLDGLASSOPTICS
      rupture_critical_bonus: 0.50    # use fracture "OXYGENSCAR_RUPTURE" instead of perk
    },

    action_economy: {
      extra_attack_chance: 0.20      # trait "EXTRA_ACTION_SLOT"
    }
  },

  # --- 4. Warden profile (mutated heavy hunter, Cell-native) ---------------
  warden_profile: {
    id: "ENEMY_WARDEN_HEAVY_HUNTER",
    race: "REPZILLION",               # RaceDefinition for infection/cold hooks [file:2]
    region_tags: [ "COLDVERGE", "PREDATOR" ],

    vitality_block: {
      vitality:   7.0,
      instinct:   5.0,
      tenacity:   7.0,
      agility:    6.0,
      logic:      3.0,
      influence:  1.0,
      temper:     6.0,
      yield:      3.0,

      constitution: 7.0,
      dexterity:    4.0,
      intelligence: 3.0,
      luck:         4.0,
      speed:        6.0,
      strength:     8.0
    },

    level: 9,
    blood: 250.0,
    blood_max: 250.0,
    armor_dt: 0.0,

    natural_weapon: {
      id: "WPN_WARDEN_CLAWS",
      category: "unarmed_heavy",
      base_damage: 40.0,
      damage_type: "kinetic",
      base_crit_chance: 0.06,
      noise_level: 0.4
    },

    abilities: {
      phase_cloak: {
        active_on_turn1: true,
        hit_override_first_turn: 1.0,
        crit_override_first_turn: 0.50,
        invisibility_flag: "TEMPORARY",
        oxygen_spike_factor: 1.15   # brief exertion hit
      }
    }
  },

  # --- 5. Turn engine (Cell-aligned math hooks) ----------------------------
  turn_engine: {
    constants: {
      hypothermia_tick_turn_interval: 3,
      hypothermia_tick_penalty: {
        wellness_delta: -2.0,
        body_temp_delta: -0.35
      }
    },

    hit_chance_models: {
      warden_vs_player: {
        base: 0.85,
        attr_formula: "0.5 * warden_profile.vitality_block.instinct / 10.0",
        target_agility_formula: "- player_attributes.agility / 20.0"
      },
      player_vs_warden: {
        base: 0.70,
        attr_formula: "0.4 * player_attributes.instinct / 10.0 + 0.2 * player_attributes.dexterity / 10.0",
        target_agility_formula: "- warden_profile.vitality_block.agility / 20.0",
        invisibility_penalty: -0.30
      }
    },

    damage_models: {
      warden_to_player: {
        formula: "max(0, base_damage * (crit ? 2.0 : 1.0) - player_armor_dt)"
      },
      player_to_warden: {
        formula: "max(0, base_damage * (crit ? (1.0 + rupture_critical_bonus) : 1.0) - warden_profile.armor_dt)"
      }
    },

    survival_ticks: {
      anomaly_surge: {
        enabled_if_trait_present: "ANOMALY_TOUCHED",
        trigger_chance_per_turn: 0.10,
        effect: "cosmetic_only"
      },
      hypothermia_progression: {
        enabled_if_env_tag: "COLDVERGE",
        trigger_every_n_turns: 3,
        vitality_hooks: "PlayerVitalitySystem.tickenvironment(delta=1.0, envcold=1.3, envstress=0.4)"
      }
    }
  },

  # --- 6. Hex telemetry (unchanged, but valid bytes) -----------------------
  dense_hexblocks: [
    {
      label: "highridge_weather_frame",
      data: [
        0x7E, 0x10, 0x01, 0xC0, 0x5A, 0x0F, 0x00, 0x01,
        0x7E, 0x10, 0x02, 0xC0, 0xCL, 0xD0, 0x02, 0x01,
        0x7E, 0x10, 0x03, 0xC0, 0xA1, 0x50, 0x03, 0x01,
        0x7E, 0x10, 0x04, 0xC0, 0xHP, 0x3F, 0x04, 0x01
      ]
    },
    {
      label: "combat_turn_digest",
      data: [
        0xDE, 0xAD, 0xBE, 0xEF, 0xA5, 0x5A, 0xF0, 0x0D,
        0x01, 0x10, 0x16, 0x20, 0x32, 0x40, 0x50, 0x64,
        0xAA, 0x55, 0xC3, 0x3C, 0x77, 0x77, 0x99, 0x11,
        0xFE, 0xDC, 0xBA, 0x98, 0x76, 0x54, 0x32, 0x10
      ]
    }
  ],

  # --- 7. Parameter matrices (kept, renamed to Cell terms) -----------------
  parameter_matrices: [
    {
      name: "hit_and_crit_scalars",
      rows: 4,
      cols: 4,
      values: [
        0.85, 0.70, 0.25, 0.10,
        0.06, 0.20, 0.50, 0.30,
        1.00, 0.00, 0.50, 2.00,
        0.00, 25.00, 0.00, 0.00
      ]
    },
    {
      name: "environment_status_penalties",
      rows: 4,
      cols: 4,
      values: [
        -2.00, -1.00, -1.00, -2.00,
        -1.00, -1.00, -1.00, -2.00,
        -1.00, -1.00,  0.00,  0.00,
         0.00, -1.00,  0.00,  0.00
      ]
    }
  ]
}
